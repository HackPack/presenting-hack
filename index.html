<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Brian Scaturro - Presenting Hack</title>

        <meta name="description" content="An overview of Facebook's new programming language: Hack">
        <meta name="author" content="Brian Scaturro">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/night.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">

                <!-- Title slide -->
                <section>
                    <h1>The Hack Programming Language</h1>
                    <h3>A better way to PHP</h3>
                    <p>
                        <small>By <a href="http://brianscaturro.com">Brian Scaturro</a> / <a href="https://twitter.com/scaturr">@scaturr</a></small>
                    </p>
                </section>

                <!-- Hack quote -->
                <section>
                    <img class="no-border" alt="hack logo" src="img/hack.jpeg" />

                    <blockquote>
                        Hack is a language for HHVM that interoperates seamlessly with PHP. The goal of Hack is to offer developers a way to write cleaner, safer and refactorable code while trying to maintain a level of compatibility with current PHP codebases.
                    </blockquote>

                    <p>
                        <br><a href="http://docs.hhvm.com/manual/en/hack.intro.whatis.php">http://docs.hhvm.com/manual/en/hack.intro.whatis.php</a>
                    </p>
                </section>
                
                <!-- Current hack projects -->
                <section>
                    <h2>Current hack things in the works:</h2>
                    <h3>i.e - how I know things about hack</h3>
                    <ul>
                        <li><a href="https://github.com/HackPack/HackUnit">HackUnit</a> - xUnit for hack</li>
                        <li><a href="https://github.com/HackPack/hacktions">hacktions</a> - Event library for hack</li>
                        <li><a href="https://github.com/HackPack/hacktions">hackqueue</a> - Socket based job queue for hack</li>
                    </ul>
                </section>

                <!-- The Type Checker -->
                <section>

                    <section>
                        <h2>The Type Checker</h2>
                        <h4>The real value of hack</h4>
                        
                        <img alt="No errors!" src="img/type-checker-no-errors.png" />
                    </section>

                    <section>
                        <h3>Catch those type errors early</h3>

                        <img src="img/type-checker-errors.png" alt="hack type errors" />
                    </section>

                    <section>
                        <h3>... even while coding</h3>

                        <img src="img/vim-type-checker.png" alt="type checker in vim" />
                    </section>

                    <section>
                        <h3>Tough type checker</h3>

                        <p>
                            The type checker is your best line of defense. However, the runtime will allow things the type checker does not approve of.
                        </p>

                        <img src="img/no-references.png" alt="Dont use references" />
                    </section>

                    <section>
                        <h3>... forgiving runtime</h3>

                        <img class="no-border" src="img/use-references.png" alt="runtime allows references" /> 

                        <img  class="no-border" src="img/use-references-output.png" alt="output of reference use" />
                    </section>

                    <section>
                        <h3>Using hh_client</h3>

                        <p>
                            The type checker is invoked by using the <code>hh_client</code> executable that installs with hack. This executable is currently only available on *nix platforms.
                        </p>
                    </section>

                    <section>
                        <h3>... be sure to search the right path</h3>

                        <p>
                            <code>hh_client</code> will search for types based on the location of a <code>.hhconfig</code> file. It is an empty file. Be sure to include this in the root of your projects.
                        </p>

                        <img src="img/hhconfig.png" alt="hack project directory structure" />
                    </section>

                </section>
                
                <!-- Type annotation -->
                <section>

                    <section>
                        <h2>Type Annotations</h2>

                        <blockquote>
                            Type annotations allow for PHP code to be explicitly typed on parameters, class member variables and return values (types are inferred for locals). These annotated types are checked via a type checker.
                        </blockquote>

                        <p>
                            <br><a href="http://docs.hhvm.com/manual/en/hack.annotations.php">http://docs.hhvm.com/manual/en/hack.annotations.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>Typed parameters and return types</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict

function sum(int x, int y): int {
    return x + y;
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>Typed class members</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict

class TestResult
{
    protected int $runCount;

    protected array&lt;Failure&gt; $failures;
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>Annotating closures</h3>
                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict

function invoke((function(int $x): int) $fn): int {
    return $fn(1);
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>Annotation with $this</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict

class FluentObject
{
    public function doThing(): this
    {
        //do something
        return $this;
    }
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>... needs a little work yet</h3>

                        <img src="img/busted-this-annotation.png" alt="this annotation doesnt work so well yet" />

                        <p>
                            <a href="https://github.com/HackPack/HackUnit/blob/bug-broken-this-annotation/Runner/Options.php">https://github.com/HackPack/HackUnit/blob/bug-broken-this-annotation/Runner/Options.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>... can workaround pretty easily for now</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict
namespace HackPack\HackUnit\Runner;

class Options
{
    protected string $testPath;

    /**
     * Use Options type since "this" annotation is broken
     * when namespaces are used
     */
    public function setTestPath(string $testPath): Options
    {
        $this->testPath;
        return $this;
    }
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>The mixed type</h3>

                        <p>
                            The hack type checker has some pretty interesting ways of handling the "mixed" type that many PHP programmers are familiar with. The type checker will give you a pass on it if it sees you are validating the type.
                        </p>
                    </section>

                    <section>
                        <h3>... has to be checked</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh

function sum(mixed $x): void {
  if (is_array($x) || $x instanceof Vector) {
    $s = 0;
    foreach ($x as $v) {
      $s += $v;
    }
    return $s;
  }
  //... do something else or throw an exception...
}
                            </code>
                        </pre>

                        <p>
                            <a href="http://docs.hhvm.com/manual/en/hack.annotations.mixedtypes.php">http://docs.hhvm.com/manual/en/hack.annotations.mixedtypes.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>Annotating generators and coroutines</h3>

                        <p>
                            PHP 5.5 introduced some features that programmers in other languages have been enjoying for years: generators and coroutines. Hack has given types to both of these.
                        </p>
                    </section>

                    <section>
                        <h3>Annotating generators</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict

function infiniteIterator(): Continuation&lt;int&gt; {
    $i = 0;
    while (true) {
        yield ++$i;
    }
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>Annotating coroutines</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh
async function f(): Awaitable&lt;int&gt; {
  return 42;
}

async function g(): Awaitable&lt;string&gt; {
  $f = await f();
  $f++;
  return 'hi test ' . $f;
}
                            </code>
                        </pre>

                        <p>
                            <a href="http://docs.hhvm.com/manual/en/hack.annotations.generators.php">http://docs.hhvm.com/manual/en/hack.annotations.generators.php</a>
                        </p>
                    </section>
                </section>

                <!-- hack modes -->
                <section>
                    <section>
                        <h2>Hack Modes</h2>

                        <p>
                            Hack has various levels of tolerance for it's type checker. These are known as modes, and they are triggered by comments.
                        </p>
                    </section>

                    <section>
                        <h3>Strict mode</h3>

                        <p>
                            For the pure of heart. Everything must be annotated and everything is type checked. Strict code cannot call into non hack code.
                        </p>
                    </section>

                    <section>
                        <h3>... a strict example</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict
class TestCase
{
    public function __construct(protected string $name)
    {
    }

    public function setUp(): void
    {
    }

    public function expect&lt;T&gt;(T $context): Expectation&lt;T&gt;
    {
        return new Expectation($context);
    }
}
                            </code>
                        </pre>
                    </section>

                    <section>
                        <h3>... strict continued</h3>

                        <p>
                            It is worth noting that top level code cannot exist in strict mode. This makes it impossible to execute a purely strict program (there is no "main" method). Partial or UNSAFE must be used as strict entry points.
                        </p>
                    </section>

                    <section>
                        <h3>A note on hhi interfaces</h3>
                        <p>
                            Strict mode will throw "Unbound name" errors when it can't find a corresponding type (including functions). Out of the box, this also includes native PHP functions! You can imagine how frustrating this would be everytime you reach for your favorite PHP function.
                        </p>

                        <p>
                            <br><a href="https://github.com/facebook/hhvm/pull/2656">https://github.com/facebook/hhvm/pull/2656</a>
                        </p>
                    </section>

                    <section>
                        <h3>... hhi interfaces continued</h3>
                        <p>
                            hhi files contain interfaces for most of the PHP core library. These files basically provide type information to hack's type checker. You only have to make sure they are on the path of the type checker. After install, these are found at <code>/usr/share/hhvm/hack/hhi</code>. Just copy them to your project's directory and you should be good.
                        </p>
                    </section>

                    <section>
                        <h3>An example hhi</h3>

                        <img src="img/hhi-example.png" alt="example of hhi interface" />
                    </section>

                    <section>
                        <h3>Partial mode</h3>

                        <blockquote>
                            Partial mode is the default of Hack. In partial mode, the type checker checks all types other than that encompassed by an // UNSAFE comment. Partial mode also allows for the partially typing of a class, method or function (e.g., only type a subset of its arguments). And, also unlike strict mode, partial mode allows engineers to call code that has not yet been "Hack-ified" (in other words, they can call into untyped code).
                        </blockquote>

                        <p>
                            <br>
                            <a href="http://docs.hhvm.com/manual/en/hack.modes.partial.php">http://docs.hhvm.com/manual/en/hack.modes.partial.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>... the safe bet for program entry</h3>

                        <p>
                            Since strict mode does not allow top level code, partial mode is the method for program entry.
                        </p>

                        <p>
                            <br>
                            <a href="https://github.com/HackPack/HackUnit/blob/master/bin/hackunit">https://github.com/HackPack/HackUnit/blob/master/bin/hackunit</a>
                        </p>
                    </section>

                    <section>
                        <h3>Decl mode</h3>

                        <blockquote>
                            Decl mode is used to allow hack code written in strict mode to call into legacy code, without having to fix the issues that would be pointed out by partial mode. The type checker will "absorb" the signatures of the code, but will not type check the code. Decl is mainly used when annotating old, existing APIs (i.e., when the code does note meet Hack's stricter subset of PHP). 
                        </blockquote>

                        <p>
                            <br>
                            <a href="http://docs.hhvm.com/manual/en/hack.modes.decl.php">http://docs.hhvm.com/manual/en/hack.modes.decl.php</a>
                        </p>

                    </section>

                    <section>
                        <h3>UNSAFE</h3>

                        <blockquote>
                            // UNSAFE disables the type checker from the point of unsafe declaration until the end of the current block of code (where the end of the current block generally refers to the associated ending brace (}) of which the // UNSAFE is declared).
                        </blockquote>

                        <p>
                            <br>
                            <a href="https://github.com/HackPack/HackUnit/blob/master/Runner/Loading/StandardLoader.php#L98">https://github.com/HackPack/HackUnit/blob/master/Runner/Loading/StandardLoader.php#L98</a>
                        </p>
                    </section>

                </section>

                <!-- generics -->
                <section>

                    <section>
                        <h2>Generics</h2>

                        <blockquote>
                            Hack introduces generics to PHP (in the same vein as statically type languages such as C# and Java). Generics allow classes and methods to be parameterized (i.e., a type associated when a class is instantiated or a method is called). 
                        </blockquote>

                        <p>
                            <br>
                            The benefit of course being: generics can be statically checked.
                        </p>

                        <p>
                            <br>
                            <a href="http://docs.hhvm.com/manual/en/hack.generics.php">http://docs.hhvm.com/manual/en/hack.generics.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>Generic interfaces are great for design</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
&lt;?hh //strict
namespace HackPack\Hacktions;

trait EventEmitter
{
    protected Map&lt;string, Vector&lt;(function(...): void)&gt;&gt; $listeners = Map {};
}
                            </code>
                        </pre>

                        <p>
                            The type checker can easily catch these sort of type constraints, and our program design is better for them.
                        </p>
                    </section>

                    <section>
                        <h3>... the dream is better than reality</h3>

                        <p>
                            While hack generics are useful type annotations, they are nowhere near as useful as generics in Java/C#.
                        </p>

                        <p>
                            This mainly stems from hack's preference for inference and the fact that a type is not a concrete thing in hack.
                        </p>
                    </section>

                    <section>
                        <h3>Inference</h3>

                        <p>
                            The preference for inference seems like a blow to readability. The following results in a type error:
                        </p>

                        <pre>
                            <code data-trim content-editable class="php">
$fun = () ==> { $fn = $this->callable; $fn(); }
$this->expectCallable($fun)->toThrow&lt;ExpectationException&gt;();

//Tests/Core/CallableExpectationTest.php|54 col 70 error|  This operator is not associative, add parentheses
                            </code>
                        </pre>

                        <p>
                            <br>
                            <a href="http://bit.ly/1mBUm25">http://bit.ly/1mBUm25</a>
                        </p>
                    </section>

                    <section>
                        <h3>... this is ok</h3>

                        <pre>
                            <code data-trim contenteditable class="php">
$fun = () ==> { $fn = $this->callable; $fn();};
$this->expectCallable($fun)->toThrow('\HackPack\HackUnit\Core\ExpectationException');
                            </code>
                        </pre>

                        <p>
                            This snippet also demonstrates we haven't left the "magic string" pattern of PHP. Types are not concrete things in hack - we still have to check types against strings.
                        </p>
                    </section>

                    <section>
                        <h3>Generics don't stack</h3>

                        <p>
                            Generics are not as useful in hack because they don't stack. What I mean by stack is explained by the following from the docs:
                        </p>

                        <blockquote>                            
                            A generic method must not collide with any existing, non-generic method name (i.e, public function swap and public function swap<T>).
                        </blockquote>

                        <p>
                            <br>
                            <a href="http://docs.hhvm.com/manual/en/hack.generics.method.php">http://docs.hhvm.com/manual/en/hack.generics.method.php</a>
                        </p>
                    </section>

                    <section>
                        <h3>... even if they should</h3>

                        <pre>
                            <code class="php" data-trim contenteditable>
&lt;?hh //strict                                
class Cook
{
    use Subject&lt;Waiter&gt;;
    use Subject&lt;Busboy&gt;;
}

//throws type errors
                            </code>
                        </pre>

                        <p>
                            <br>
                            <a href="https://github.com/HackPack/hacktions">https://github.com/HackPack/hacktions</a>
                        </p>
                    </section>

                    <section>
                        <h3>Summary</h3>

                        <p>
                            Generics are really useful design tools. Their presence in hack is a welcome addition that is not present in vanilla PHP. However, they are not as useful as they are in other languages.
                        </p>
                    </section>

                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Parallax scrolling
                // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
                // parallaxBackgroundSize: '2100px 900px',

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
